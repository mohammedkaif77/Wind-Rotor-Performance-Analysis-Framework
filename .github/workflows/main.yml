name: Wind Rotor ML Engineering Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:

      # 1️⃣ Checkout Repository
      - name: Checkout Repository
        uses: actions/checkout@v3

      # 2️⃣ Setup Python
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # 3️⃣ Install Dependencies
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4️⃣ Run Linting (Code Quality Check)
      - name: Run Linting
        run: flake8 src/ || true

      # 5️⃣ Run Unit Tests
      - name: Run Tests
        run: pytest

      # 6️⃣ Generate Dataset
      - name: Generate Dataset
        run: python -c "from src.data_generator import generate_wind_dataset; generate_wind_dataset()"

      # 7️⃣ Train & Evaluate Model (Includes Performance Gate)
      - name: Train & Evaluate Model
        run: python main.py

      # 8️⃣ Upload Artifacts (Reports + Model + Data)
      - name: Upload Artifacts
        uses: actions/upload-artifact@v3
        with:
          name: wind-rotor-artifacts
          path: |
            reports/
            data/
